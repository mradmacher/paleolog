<div class="ui grid">
  <div class="sixteen wide column">
    <fieldset class="ui grid">
      <div class="fourteen wide column">
        <h1 class="ui header">Projects (<%= @projects.size %>)</h1>
      </div>
      <div class="two wide column">
        <button class="ui basic button add-project-action">Add</button>
      </div>
    </fieldset>
    <div class="ui modal" id="project-form-window">
      <div class="header">Add Project</div>
      <div class="content">
        <%= erb :'_validation_messages.html', layout: false %>
        <form class="ui form" id="project-form">
          <div class="field">
            <label for="project-name">Name</label>
            <input id="project-name" type="text" name="name" />
          </div>
        </form>
      </div>
      <div class="actions">
        <button class="ui cancel negative button">Cancel</button>
        <button class="ui approve positive button">Save</button>
      </div>
    </div>
  </div>
  <div class="three wide column">
    <form id="species-search" class="ui form">
      <fieldset>
        <legend>Find project</legend>
        <div class="field">
          <label for="search_name">Name</label>
          <input id="search_name" type="text" name="name" value="<%= @filters[:name] %>"/>
        </div>
        <button class="ui button" type="submit">Search</button>
      </fieldset>
    </form>
  </div>
  <div class="thirteen wide column">
    <table class="ui celled table">
    <thead>
      <tr>
        <th>Project name</th>
        <th>Date created</th>
      </tr>
    </thead>
    <tbody>
      <% @projects.each do |project| %>
        <tr>
          <td><a href="<%= project_path(project) %>"><%= project.name %></a></td>
          <td><%= project.created_at&.to_date %></td>
        </tr>
      <% end %>
    </tbody>
    </table>
  </div>
</div>

<script type="text/javascript">
$(function() {
  $('.add-project-action').click(() => {
    var validationMessageView = new ValidationMessageView('project');
    validationMessageView.hide();
    $('#project-form').trigger('reset');
    $('#project-form-window').modal({
      closable: false,
      onApprove: function() {
        const attrs = {
          name: $('#project-form #project-name').val(),
        }
        var service = new ProjectRequest
        service.create(attrs).then(
          project => {
            window.location.reload();
          },
          errors => {
            validationMessageView.show(errors)
          }
        )
        return false;
      }
    })
    .modal('show');
  });
});
</script>
